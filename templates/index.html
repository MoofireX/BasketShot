<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üèÄ NBA Shot Physics Analyzer</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Bangers&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        header {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            padding: 2rem;
            text-align: center;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        header h1 {
            font-family: 'Bangers', cursive;
            font-size: 3.5rem;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5);
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 2;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 800px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        input, select, button {
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-family: 'Orbitron', sans-serif;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #ff6b35;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 53, 0.3);
        }

        button {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(255, 107, 53, 0.4);
        }

        .court-preview {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.5rem;
            margin: 2rem auto;
            max-width: 600px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .court-preview h3 {
            color: #ff6b35;
            font-family: 'Bangers', cursive;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .court-preview img {
            max-width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            border: 3px solid #ff6b35;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            padding: 2rem;
            max-width: 1000px;
            margin: auto;
            perspective: 1000px;
        }

        .tile {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }

        .tile img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .tile:hover {
            transform: translateY(-10px) rotateX(5deg) rotateY(5deg);
            border-color: #ff6b35;
            box-shadow: 0 20px 40px rgba(255, 107, 53, 0.3);
            z-index: 10;
        }

        .tile:hover img {
            transform: scale(1.1);
        }

        .error {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff4444;
            color: #ff4444;
            padding: 1rem;
            border-radius: 12px;
            margin: 2rem auto;
            max-width: 800px;
            text-align: center;
            font-weight: 500;
        }

        /* Comic-style popup */
        .comic-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: #fff;
            color: #333;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 400px;
            width: 90%;
            border: 8px solid #ff6b35;
            position: relative;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .comic-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .comic-popup::before {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 30px;
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 20px solid #ff6b35;
        }

        .comic-popup::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 35px;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 15px solid #fff;
        }

        .popup-header {
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            color: #ff6b35;
            text-align: center;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            margin: 0.5rem 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            color: white;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .stat-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .close-popup {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 40px;
            height: 40px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-popup:hover {
            transform: rotate(90deg) scale(1.1);
            background: #e55a2b;
        }

        .info-btn {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .info-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .info-modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .info-content {
            background: white;
            color: #333;
            border-radius: 20px;
            padding: 2rem;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            margin: 2rem;
            border: 5px solid #ff6b35;
            position: relative;
            transform: translateY(-50px);
            transition: transform 0.3s ease;
        }

        .info-modal.show .info-content {
            transform: translateY(0);
        }

        .info-content h1, .info-content h2 {
            color: #ff6b35;
            font-family: 'Bangers', cursive;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .info-content h1 {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 1rem;
            border-bottom: 3px solid #ff6b35;
            padding-bottom: 1rem;
        }

        .info-content h2 {
            font-size: 1.5rem;
            margin: 1.5rem 0 1rem;
        }

        .info-content code {
            background: #f4f4f4;
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            color: #e55a2b;
            font-weight: bold;
        }

        .info-content pre {
            background: #1e1e1e;
            color: #00ff41;
            padding: 1rem;
            border-radius: 10px;
            overflow-x: auto;
            margin: 1rem 0;
            border: 2px solid #ff6b35;
        }

        .info-content ul {
            padding-left: 2rem;
        }

        .info-content li {
            margin: 0.5rem 0;
            line-height: 1.6;
        }

        .formula-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1rem 0;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            border: 3px solid #ff6b35;
        }

        .close-info {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 50px;
            height: 50px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-info:hover {
            transform: rotate(90deg) scale(1.1);
            background: #e55a2b;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 2rem;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.3);
            border-top: 6px solid #ff6b35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 4px;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>

    <header>
        <h1>üèÄ NBA Shot Physics Analyzer</h1>
        <p>Analyze your shooting performance with advanced physics calculations</p>
        <button class="info-btn" onclick="showInfoModal()">‚ÑπÔ∏è Physics Info</button>
    </header>

    <!-- Court Preview -->
    <div class="court-preview">
        <h3>üèÄ Basketball Court Analysis</h3>
        {% if court_image_url %}
            <img src="{{ url_for('static', filename=court_image_url) }}" alt="Basketball Court">
        {% else %}
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3Crect width='800' height='400' fill='%23d2691e'/%3E%3Cpath d='M50 50 L750 50 L750 350 L50 350 Z' fill='none' stroke='white' stroke-width='4'/%3E%3Ccircle cx='125' cy='200' r='75' fill='none' stroke='white' stroke-width='3'/%3E%3Crect x='50' y='150' width='75' height='100' fill='%23ff6b35' stroke='white' stroke-width='2'/%3E%3Cpath d='M125 175 L125 225' stroke='white' stroke-width='3'/%3E%3Ctext x='400' y='200' fill='white' font-size='24' text-anchor='middle'%3ECOURT ANALYSIS%3C/text%3E%3C/svg%3E" alt="Basketball Court">
        {% endif %}
        <p style="margin-top: 1rem; opacity: 0.8;">Using standard NBA court dimensions for shot trajectory analysis</p>
    </div>

    {% if error %}
    <div class="error">
        <strong>Error:</strong> {{ error }}
    </div>
    {% endif %}

    <div class="form-container">
        <form method="POST" action="/" id="shotForm">
            <div class="form-grid">
                <input type="number" name="height" placeholder="Height (inches)" required step="0.1">
                <input type="number" name="weight" placeholder="Weight (lbs)" required step="0.1">
                <select name="athleticism" required>
                    <option value="">Select Skill Level</option>
                    <option value="1">üèÉ Beginner</option>
                    <option value="2">üèÉ‚Äç‚ôÇÔ∏è Intermediate</option>
                    <option value="3">üèÄ Pro Level</option>
                </select>
                <button type="submit">üöÄ Analyze My Shot</button>
            </div>
        </form>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Calculating shot physics...</p>
    </div>

    <div id="grid" class="grid">
        {% for tile in tiles %}
        <div class="tile" onclick='showPopup({{ tile.r }}, {{ tile.c }}, {{ tile.parabolas | tojson }}, {{ tile.x_start }}, {{ tile.x_end }})'>
            <img src="{{ url_for('static', filename='tiles/' + tile.filename) }}" alt="Court tile {{ tile.r }}, {{ tile.c }}">
        </div>
        {% endfor %}
    </div>

    <div id="scene-container" style="width: 100%; height: 500px; background-color: #f0f0f0;"></div>

    <!-- Comic-style popup -->
    <div class="overlay" id="overlay" onclick="closePopup()"></div>
    <div class="comic-popup" id="popup">
        <button class="close-popup" onclick="closePopup()">√ó</button>
        <div class="popup-header">SHOT ANALYSIS</div>
        <div class="stat-item">
            <span class="stat-label">Position</span>
            <span class="stat-value" id="position-value">-</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Acceleration</span>
            <span class="stat-value" id="acceleration-value">- m/s¬≤</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Force Required</span>
            <span class="stat-value" id="force-value">- N</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Release Time</span>
            <span class="stat-value" id="release-time-value">- s</span>
        </div>
        <button class="info-btn" style="position: static; margin-top: 1rem;" onclick="showPlotModal()">Plot Trajectory</button>
    </div>

    <!-- Physics Info Modal -->
    <div class="info-modal" id="infoModal">
        <div class="info-content">
            <button class="close-info" onclick="closeInfoModal()">√ó</button>
            <h1>üî¨ The Unified Physics Behind Your Shot</h1>
            <p>The simulation uses a unified physics model to ensure the shot's path and the forces required are perfectly synchronized. Here‚Äôs the step-by-step breakdown:</p>

            <!-- Section 1: Initial Velocity -->
            <h2>Part 1: Calculating the Required Initial Velocity (v‚ÇÄ)</h2>
            <p>Everything starts with calculating the initial velocity (<code>v‚ÇÄ</code>) needed for the ball to travel from your hands to the hoop at a specific angle. This is the cornerstone of the entire calculation.</p>
            
            <h4>The Core Equation:</h4>
            <p>We use the standard projectile motion equation, which describes the path of a thrown object under gravity:</p>
            <pre><code>y(x) = x * tan(Œ∏) - (g * x¬≤) / (2 * v‚ÇÄ¬≤ * cos¬≤(Œ∏))</code></pre>
            <p>We know the start (x‚ÇÅ, y‚ÇÅ) and end (x‚ÇÇ, y‚ÇÇ) points, the angle (Œ∏), and gravity (g). By rearranging the formula to solve for the initial velocity squared (<code>v‚ÇÄ¬≤</code>), we get:</p>
            <div class="formula-box">
                <strong>Initial Velocity Squared (v‚ÇÄ¬≤)</strong><br>
                <code>v‚ÇÄ¬≤ = (g * distance_x¬≤) / (2 * cos¬≤(Œ∏) * (distance_x*tan(Œ∏) - y_diff))</code>
                <br><small>where <strong>distance_x</strong> is the horizontal distance to the hoop and <strong>y_diff</strong> is the vertical distance between your hands and the hoop.</small>
            </div>

            <!-- Section 2: Parabola from Velocity -->
            <h2>Part 2: Plotting the Parabola from Physics</h2>
            <p>Instead of calculating the parabola separately, we now derive it directly from the initial velocity we just found. This guarantees the visual path matches the physics.</p>
            
            <h4>The Equation: <code>y = ax¬≤ + bx + c</code></h4>
            <p>The coefficients <code>a</code>, <code>b</code>, and c are now calculated based on our <code>v‚ÇÄ</code> and the laws of motion:</p>
            
            <div class="formula-box">
                <strong>Coefficient `a`</strong><br>
                <code>a = -g / (2 * v‚ÇÄ¬≤ * cos¬≤(Œ∏))</code>
                <br><small>This term represents the effect of gravity on the arc.</small>
            </div>
            <div class="formula-box">
                <strong>Coefficient `b`</strong><br>
                <code>b = tan(Œ∏) - (2 * a * x‚ÇÅ)</code>
                <br><small>This term represents the initial slope of the shot at your release point (x‚ÇÅ).</small>
            </div>
            <div class="formula-box">
                <strong>Coefficient `c`</strong><br>
                <code>c = y‚ÇÅ - (x‚ÇÅ * tan(Œ∏)) + (a * x‚ÇÅ¬≤)</code>
                <br><small>This ensures the parabola starts exactly at your hand height (y‚ÇÅ).</small>
            </div>

            <!-- Section 3: Shot Dynamics -->
            <h2>Part 3: Calculating the Force and Acceleration</h2>
            <p>Finally, we determine the physical effort required to generate the initial velocity (<code>v‚ÇÄ</code>).</p>

            <h4>The Formulas:</h4>
            <div class="formula-box">
                <strong>Force (F)</strong><br>
                <code>Force = (0.5 * mass * v‚ÇÄ¬≤) / push_distance</code>
                <br><small>Based on the <strong>Work-Energy Theorem</strong>, this is the average force needed over your pushing motion.</small>
            </div>
            <div class="formula-box">
                <strong>Acceleration (a)</strong><br>
                <code>a = (Force / mass) * athleticism_factor</code>
                <br><small>Using <strong>Newton's Second Law (F=ma)</strong>, we find the ball's acceleration, adjusted by your skill level.</small>
            </div>
        </div>
    </div>

    <div class="info-modal" id="plotModal">
        <div class="info-content" style="width: 80vw; max-width: 1000px;">
            <button class="close-info" onclick="closePlotModal()">√ó</button>
            <h1>Shot Trajectory</h1>
            <canvas id="parabolaChart" width="800" height="400"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let currentParabolas = [];
        let currentXStart = 0;
        let currentXEnd = 0;
        let parabolaChart = null;

        // Create floating particles
        function createParticles() {
            const container = document.getElementById('particles');
            if (!container) return;
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 10 + 2 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                container.appendChild(particle);
            }
        }

        // Show comic popup
        function showPopup(r, c, parabolas, xStart, xEnd) {
            document.getElementById('position-value').textContent = `(${r}, ${c})`;
            
            // For simplicity, we'll show the stats for the first parabola in the main popup
            const firstParabola = parabolas[0];
            document.getElementById('acceleration-value').textContent = firstParabola.acceleration + ' m/s¬≤';
            document.getElementById('force-value').textContent = firstParabola.force + ' N';
            document.getElementById('release-time-value').textContent = firstParabola.release_time + ' s';
            
            currentParabolas = parabolas;
            currentXStart = xStart;
            currentXEnd = xEnd;

            document.getElementById('overlay').classList.add('show');
            document.getElementById('popup').classList.add('show');
        }

        // Close popup
        function closePopup() {
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('popup').classList.remove('show');
        }

        // Form submission with loading
        document.getElementById('shotForm').addEventListener('submit', function(e) {
            document.getElementById('loading').classList.add('show');
        });

        // Initialize particles on load
        window.addEventListener('load', function() {
            createParticles();
        });

        // Close popups with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePopup();
                closeInfoModal();
                closePlotModal();
            }
        });

        // Info modal functions
        function showInfoModal() {
            document.getElementById('infoModal').classList.add('show');
        }

        function closeInfoModal() {
            document.getElementById('infoModal').classList.remove('show');
        }

        // Plot modal functions
        function showPlotModal() {
            closePopup();
            document.getElementById('plotModal').classList.add('show');
            
            const datasets = currentParabolas.map(parabola => {
                const { a, b, c, angle } = parabola;
                const data = [];
                const numPoints = 100;
                const xRange = currentXEnd - currentXStart;
                const step = xRange / numPoints;

                for (let i = 0; i <= numPoints; i++) {
                    const x = currentXStart + i * step;
                    const y = a * (x**2) + b * x + c;
                    data.push({ x: x, y: y });
                }
                return {
                    label: `Launch Angle ${angle}¬∞`,
                    data: data,
                    borderColor: angle === 45 ? '#ff6b35' : '#667eea',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: false,
                    pointRadius: 0,
                };
            });

            const ctx = document.getElementById('parabolaChart').getContext('2d');
            if (parabolaChart) {
                parabolaChart.destroy();
            }
            parabolaChart = new Chart(ctx, {
                type: 'line',
                data: { datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Distance from baseline (m)',
                                font: { size: 16, family: 'Orbitron' },
                                color: '#333'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Height (m)',
                                font: { size: 16, family: 'Orbitron' },
                                color: '#333'
                            },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: { size: 14, family: 'Orbitron' }
                            }
                        }
                    }
                }
            });
        }

        function closePlotModal() {
            document.getElementById('plotModal').classList.remove('show');
        }

        // Three.js scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / 500, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, 500);
        document.getElementById('scene-container').appendChild(renderer.domElement);

        // Add the court
        const courtTexture = new THREE.TextureLoader().load("{{ url_for('static', filename='nbacourt.jpg') }}");
        const courtMaterial = new THREE.MeshBasicMaterial({ map: courtTexture });
        const courtGeometry = new THREE.PlaneGeometry(15, 30);
        const court = new THREE.Mesh(courtGeometry, courtMaterial);
        court.rotation.x = -Math.PI / 2;
        scene.add(court);

        // Add the hoop
        const hoopGeometry = new THREE.TorusGeometry(0.5, 0.1, 16, 100);
        const hoopMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        const hoop = new THREE.Mesh(hoopGeometry, hoopMaterial);
        hoop.position.y = 3.05;
        hoop.position.z = -13;
        hoop.rotation.x = Math.PI / 2;
        scene.add(hoop);

        // Add the ball
        const ballGeometry = new THREE.SphereGeometry(0.1, 32, 32);
        const ballMaterial = new THREE.MeshBasicMaterial({ color: 0xff8c00 });
        const ball = new THREE.Mesh(ballGeometry, ballMaterial);
        ball.position.y = 1;
        scene.add(ball);

        scene.add(ball);

        // Add lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(0, 1, 1);
        scene.add(directionalLight);

        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
